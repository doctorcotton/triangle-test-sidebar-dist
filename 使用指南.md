# 三点测试助手 - 使用指南

## 目录

1. [快速开始](#快速开始)
2. [字段配置模式](#字段配置模式)
3. [PDF 生成模式](#pdf-生成模式)
4. [结果统计模式](#结果统计模式)
5. [常见问题](#常见问题)
6. [注意事项](#注意事项)

---

## 快速开始

### 首次使用步骤

1. **打开边栏插件**
   - 在飞书多维表格中，点击右侧边栏图标
   - 找到并打开「三点测试助手」插件

2. **配置字段（必需）**
   - 首次使用必须先配置字段，否则无法正常使用
   - 切换到「字段配置模式」标签页
   - 按照下文「字段配置模式」章节完成配置

3. **开始使用**
   - 配置完成后，即可使用「PDF 生成模式」和「结果统计模式」

---

## 字段配置模式

### 功能说明

字段配置模式用于配置插件需要使用的所有表、视图和字段的 ID。配置信息会保存在「三点测试助手配置表」中，插件会自动创建这个表。

### 配置步骤

#### 1. 进入配置模式

点击顶部标签栏的「字段配置模式」按钮。

#### 2. 了解配置分类

配置项分为四个类别：

- **六组字段**：配置 A1-A3、B1-B3 六个组别的字段
  - 每个组别需要配置 3 个字段：
    - 选项字段：存储三个选项值（如：A、B、C）
    - 正确答案字段：存储正确答案（如：A）
    - 二维码字段：存储二维码链接地址

- **PDF模式**：配置 PDF 生成相关的表和字段
  - PDF 表 ID：存储测试方案的主表
  - PDF 视图 ID：用于筛选和显示记录
  - 测试类型字段：存储测试类型（如：备选测试、工厂样品）
  - 测试样品名称字段：存储样品名称
  - 测试方案附件字段：用于上传生成的 PDF（可选）

- **统计模式**：配置统计相关的表和字段
  - 统计表 ID：存储测试结果数据的表
  - 统计视图 ID：用于筛选和显示记录
  - 关联字段：关联到测试名称的字段
  - 组别字段：存储组别（A1-A3、B1-B3）
  - 问卷结果字段：存储填表人的选择
  - 评价字段：存储评价内容
  - 修改人字段：存储填表人信息
  - 创建日期字段：存储记录创建时间
  - A1-A3、B1-B3 正确答案字段：引用字段，指向 PDF 表中的正确答案

- **报告写入**：配置报告写入相关的表和字段
  - 报告表 ID：写入报告的表（通常与 PDF 表相同）
  - 报告字段：存储 Markdown 格式的报告
  - 测试结论字段：存储测试结论

#### 3. 配置方法

**配置表/视图：**

1. 点击配置项的下拉框
2. 在搜索框中输入表名或视图名进行搜索
3. 选择对应的表或视图

**配置字段：**

1. 先配置对应的「表 ID」
2. 点击字段配置项的下拉框
3. 系统会自动过滤出该表中的字段
4. 在搜索框中输入字段名进行搜索
5. 选择对应的字段

**特殊说明：**

- 附件字段：系统会自动过滤，只显示附件类型的字段
- 组别字段：系统会自动匹配，A1 相关字段只显示包含 "A1" 的字段
- 文本字段：某些配置项只显示文本类型的字段

#### 4. 保存配置

1. 完成所有配置后，点击「保存到配置表」按钮
2. 系统会显示保存状态
3. 配置保存后立即生效，无需重启插件

#### 5. 恢复默认配置

如果配置出错，可以点击「恢复默认」按钮，恢复到系统默认配置（需要根据实际情况重新配置）。

### 配置示例

假设你的多维表格结构如下：

- **测试方案表**（表 ID: `tblXXX`）
  - 测试名称（文本字段）
  - 测试类型（单选字段）
  - 测试样品（文本字段）
  - A1 选项（文本字段）
  - A1 正确答案（文本字段）
  - A1 二维码（文本字段）
  - ...（其他组别字段）
  - 测试方案附件（附件字段）

- **测试结果表**（表 ID: `tblYYY`）
  - 关联测试（关联字段，指向测试方案表）
  - 组别（单选字段：A1/A2/A3/B1/B2/B3）
  - 问卷结果（文本字段）
  - 评价（文本字段）
  - 填表人（人员字段）
  - A1 正确答案（引用字段，指向测试方案表的 A1 正确答案字段）
  - ...（其他组别正确答案字段）

**配置步骤：**

1. 在「PDF模式」中：
   - PDF 表 ID：选择「测试方案表」
   - PDF 视图 ID：选择该表的某个视图
   - 测试类型字段：选择「测试类型」
   - 测试样品名称字段：选择「测试样品」
   - 测试方案附件字段：选择「测试方案附件」

2. 在「六组字段」中：
   - A1 选项字段：选择「A1 选项」
   - A1 正确答案字段：选择「A1 正确答案」
   - A1 二维码字段：选择「A1 二维码」
   - 重复配置 A2-A3、B1-B3

3. 在「统计模式」中：
   - 统计表 ID：选择「测试结果表」
   - 统计视图 ID：选择该表的某个视图
   - 关联字段：选择「关联测试」
   - 组别字段：选择「组别」
   - 问卷结果字段：选择「问卷结果」
   - 评价字段：选择「评价」
   - 修改人字段：选择「填表人」
   - A1 正确答案字段：选择「A1 正确答案」（引用字段）
   - 重复配置 A2-A3、B1-B3

4. 在「报告写入」中：
   - 报告表 ID：选择「测试方案表」（与 PDF 表相同）
   - 报告字段：选择用于存储报告的文本字段
   - 测试结论字段：选择用于存储结论的文本字段

---

## PDF 生成模式

### 功能说明

PDF 生成模式用于从飞书表格读取测试方案数据，生成包含测试摘要、二维码的 PDF 文档。生成的 PDF 包含三页：

1. **摘要页**：测试信息汇总和数据表格
2. **二维码页**：6 组二维码横版布局
3. **竖版二维码页**：6 列 × 8 行布局，便于裁剪分发

### 使用步骤

#### 1. 进入 PDF 生成模式

点击顶部标签栏的「PDF 生成模式」按钮。

#### 2. 选择测试记录

**浏览记录：**

- 记录列表显示当前视图中的所有记录
- 每条记录显示索引号和主字段值（通常是测试名称）
- 点击记录即可选中（选中的记录会高亮显示）

**搜索记录：**

- 在搜索框中输入关键字
- 系统会实时过滤匹配的记录
- 点击搜索框右侧的 ✕ 按钮清除搜索

**分页浏览：**

- 如果记录较多，系统会分页显示（每页 10 条）
- 使用「上一页」「下一页」按钮翻页
- 页面底部显示当前页码和总页数

**刷新记录：**

- 点击「刷新记录」按钮可以重新加载记录列表
- 适用于数据更新后需要刷新显示的情况

#### 3. 读取数据

1. 选中一条记录后，点击「读取数据」按钮
2. 系统会从飞书表格读取该记录的所有测试方案数据
3. 读取成功后，下方「数据预览」区域会显示数据

#### 4. 检查数据预览

数据预览区域显示：

- **测试信息**：
  - 测试名称
  - 测试样品
  - 测试类型

- **组别数据表格**：
  - 组别：A1、A2、A3、B1、B2、B3
  - 排布：三个选项的值
  - 标注：样品标注（如：备选、备选、标品）
  - 正确：正确答案

**检查要点：**

- 确认测试信息是否正确
- 确认每个组别的三个选项都已填写
- 确认正确答案字段有值
- 确认二维码字段有值（如果为空，生成的二维码会显示「缺少链接」）

#### 5. 生成 PDF

1. 确认数据无误后，点击「生成 PDF」按钮
2. 系统会显示生成进度：
   - 正在生成 PDF...
   - 正在加载中文字体...
   - 正在嵌入字体...
   - 正在上传PDF到飞书附件字段...（如果配置了附件字段）

3. 生成完成后：
   - PDF 文件会自动下载到本地
   - 如果配置了附件字段，PDF 会自动上传到对应记录的附件字段
   - 状态栏会显示成功信息

#### 6. 查看生成的 PDF

**PDF 内容说明：**

- **第一页（摘要页）**：
  - 顶部：测试名称、生成时间
  - 中部：测试信息（测试名称、测试样品、测试类型）
  - 底部：数据表格（组别、排布、标注、正确答案）

- **第二页（二维码页）**：
  - 横版布局，6 组二维码并排显示
  - 每个二维码下方标注组别（A1-A3、B1-B3）

- **第三页（竖版二维码页）**：
  - 竖版 A4 布局，6 列 × 8 行
  - 第一列：A1 组二维码（重复 8 次）
  - 第二列：A2 组二维码（重复 8 次）
  - 第三列：A3 组二维码（重复 8 次）
  - 第四列：B1 组二维码（重复 8 次）
  - 第五列：B2 组二维码（重复 8 次）
  - 第六列：B3 组二维码（重复 8 次）
  - 便于按列裁剪，分发给不同组别的测试人员

### 常见问题

**Q: 生成的 PDF 中中文显示为空白或乱码？**

A: 这是因为中文字体加载失败。解决方案：
- 检查网络连接
- 或将中文字体文件放到项目的 `public/fonts/` 目录

**Q: 二维码显示「缺少链接」？**

A: 检查对应组别的「二维码字段」是否有值。如果字段为空，二维码会显示「缺少链接」。

**Q: PDF 没有自动上传到附件字段？**

A: 检查是否在「字段配置模式」中配置了「测试方案附件字段」。如果未配置，PDF 只会下载到本地，不会上传。

---

## 结果统计模式

### 功能说明

结果统计模式用于统计测试结果，按照 GB/T 12311-2012 标准进行显著性判定，生成符合规范的 Markdown 格式报告。

### 使用步骤

#### 1. 进入结果统计模式

点击顶部标签栏的「结果统计模式」按钮。

#### 2. 选择测试名称

**选择测试：**

1. 在「测试名称」下拉框中选择要统计的测试
2. 下拉框会显示所有可用的测试名称
3. 如果显示「（暂无数据）」，说明统计表中没有数据

**搜索测试：**

1. 在「搜索测试名称」输入框中输入关键字
2. 系统会实时过滤匹配的测试名称
3. 适用于测试名称较多的情况

#### 3. 设置每组人数

1. 在「每组人数」输入框中输入期望的每组人数
2. 系统会使用这个值计算预期样本量（每组人数 × 6 组）
3. 用于验证实际样本量是否符合预期

**说明：**

- 如果实际样本量与预期不一致，系统会显示警告
- 如果实际样本量低于预期，系统会提示样本不足，无法按规则判定

#### 4. 设置报告写入记录 ID（可选）

1. 在「报告写入记录 ID」输入框中输入记录 ID
2. 这个 ID 对应 PDF 表中的某条记录
3. 生成报告后，可以使用「写入报告字段」按钮将报告写入该记录

**如何获取记录 ID：**

- 在飞书多维表格中，选中记录后，可以从 URL 中看到记录 ID
- 或者使用飞书 API 获取

#### 5. 读取统计数据

1. 点击「读取统计数据」按钮
2. 系统会从统计表中读取该测试名称下的所有记录
3. 读取成功后，下方会显示数据概览和正确记录明细

#### 6. 查看数据概览

数据概览区域显示：

- **测试信息**：
  - 测试名称
  - 有效记录数
  - 每组人数（期望值）

- **样本量提示**：
  - 如果样本量不符合预期，会显示警告信息
  - 红色文字提示需要注意的问题

- **各组统计表格**：
  - 组别：A1-A3、B1-B3
  - 人数：该组别的记录数
  - 正确：该组别答对的记录数
  - 正确率：正确数 / 人数 × 100%

#### 7. 查看正确记录明细

正确记录明细表格显示所有答对的记录：

- 组别：记录所属组别
- 填表人：修改人字段的值
- 评价：评价字段的值

#### 8. 生成 MD 报告

1. 点击「生成 MD 报告」按钮
2. 系统会根据统计数据生成 Markdown 格式的报告
3. 报告会显示在下方的「Markdown 报告」区域

**报告内容：**

- **一、测试批次**：测试名称、测试样品
- **二、测试方法**：参照 GB/T 12311-2012 标准
- **三、测试原理**：
  - 测试类型和显著性水平（α）
  - 判定规则说明
  - 样本量说明
- **四、测试结果**：
  - 样本量验证结果
  - 正确数统计
  - 判定结果（通过/未通过）
- **五、测试结论**：最终的测试结论
- **表1：各组三联样检验结果**：详细的组别统计表格
- **表2：正确记录明细**：所有正确记录的明细

#### 9. 复制报告

1. 点击「复制 MD」按钮
2. 报告内容会复制到剪贴板
3. 可以粘贴到其他文档或系统中

#### 10. 写入报告字段（可选）

1. 确保已设置「报告写入记录 ID」
2. 点击「写入报告字段」按钮
3. 系统会将报告写入对应记录的「报告字段」
4. 同时会将测试结论写入「测试结论字段」

**说明：**

- 如果未设置记录 ID，按钮会禁用
- 写入成功后，可以在飞书表格中查看报告内容

### 判定规则说明

#### 备选测试（相似检验，α=0.05）

**适用场景：** 检验备选样品与标品是否相似

**判定规则：**

- 样本量 ≤ 42：最大允许正确数 16（显著阈值 17）
- 样本量 43-54：按 GB/T 12311-2012 表值计算最大允许正确数
- **通过标准**：正确数 < 阈值（无显著差异，样品相似）
- **未通过标准**：正确数 ≥ 阈值（存在显著差异，样品不相似）

#### 工厂样品（差异检验，α=0.10）

**适用场景：** 检验工厂样品与标品是否存在差异

**判定规则：**

- 样本量 ≤ 36：固定阈值 18
- 样本量 37-54：按 GB/T 12311-2012 表值计算阈值
- **通过标准**：正确数 ≥ 阈值（存在显著差异，样品有差异）
- **未通过标准**：正确数 < 阈值（无显著差异，样品无差异）

**注意：** 两种测试类型的判定逻辑相反，请根据实际测试类型选择。

### 常见问题

**Q: 为什么显示「样本量不足，无法按规则判定」？**

A: 实际样本量低于预期样本量（每组人数 × 6）。需要补足样本后再次生成报告。

**Q: 如何确定测试类型？**

A: 测试类型从 PDF 表的「测试类型字段」中读取。确保该字段的值是「备选测试」或「工厂样品」。

**Q: 报告中的判定结果如何理解？**

A: 
- **备选测试**：通过 = 样品相似（无显著差异），未通过 = 样品不相似（存在显著差异）
- **工厂样品**：通过 = 样品有差异（存在显著差异），未通过 = 样品无差异（无显著差异）

**Q: 如何修改每组人数？**

A: 在「每组人数」输入框中直接修改数值即可。修改后需要重新点击「读取统计数据」才会生效。

---

## 常见问题

### 配置相关问题

**Q: 配置表在哪里？**

A: 配置表名为「三点测试助手配置表」，插件会自动创建。你可以在多维表格的表列表中找到它。

**Q: 配置错了怎么办？**

A: 可以点击「恢复默认」按钮恢复默认配置，然后重新配置。或者直接在配置表中修改「值」字段。

**Q: 如何查看字段 ID？**

A: 
- 方法1：在飞书多维表格中，选中字段后，可以从浏览器开发者工具中查看
- 方法2：使用飞书 API 获取字段元数据
- 方法3：在配置模式下，下拉框会显示字段 ID（格式：字段名 (fldXXX)）

### PDF 生成相关问题

**Q: PDF 生成很慢？**

A: PDF 生成需要时间，特别是包含中文字体时。请耐心等待，不要重复点击按钮。

**Q: PDF 文件很大？**

A: 如果嵌入了中文字体，PDF 文件会比较大（通常 1-2MB）。这是正常现象。

**Q: 可以修改 PDF 布局吗？**

A: PDF 布局是固定的，如需修改需要联系开发人员修改代码。

### 统计相关问题

**Q: 统计表中没有数据？**

A: 检查「统计表 ID」和「统计视图 ID」配置是否正确，以及统计表中是否有记录。

**Q: 为什么某些组别显示 0 人？**

A: 检查「组别字段」的值是否正确（应该是 A1、A2、A3、B1、B2、B3 之一）。

**Q: 报告格式可以修改吗？**

A: 报告格式按照 GB/T 12311-2012 标准生成，如需修改需要联系开发人员修改代码。

### 其他问题

**Q: 插件无法加载？**

A: 
- 检查网络连接
- 刷新页面重试
- 检查浏览器控制台是否有错误信息

**Q: 数据读取失败？**

A: 
- 检查字段配置是否正确
- 检查是否有权限访问对应的表和字段
- 检查字段类型是否匹配（如附件字段必须选择附件类型）

**Q: 如何反馈问题？**

A: 请联系开发人员，提供以下信息：
- 问题描述
- 操作步骤
- 错误信息（如有）
- 浏览器控制台错误（如有）

---

## 注意事项

### 数据准备

1. **测试方案表**：
   - 确保每个组别的三个选项字段都已填写
   - 确保正确答案字段有值
   - 确保二维码字段有值（如果需要生成二维码）

2. **统计表**：
   - 确保「关联字段」正确关联到测试方案表
   - 确保「组别字段」的值是 A1、A2、A3、B1、B2、B3 之一
   - 确保「问卷结果字段」的值与选项字段的值匹配

### 使用建议

1. **首次使用**：
   - 先完成字段配置
   - 使用一条测试记录进行 PDF 生成测试
   - 确认 PDF 内容正确后再批量生成

2. **数据维护**：
   - 定期检查配置是否正确
   - 确保测试方案数据完整
   - 确保统计数据的组别和答案字段正确

3. **报告生成**：
   - 生成报告前先检查数据概览
   - 确认样本量符合预期
   - 仔细阅读判定结果和结论

### 权限要求

- 需要读取和写入配置表的权限
- 需要读取 PDF 表的权限
- 需要读取统计表的权限
- 需要写入报告字段的权限（如果使用报告写入功能）
- 需要上传附件的权限（如果使用 PDF 上传功能）

### 数据安全

- 配置信息存储在飞书多维表格中，请妥善保管
- 生成的 PDF 包含测试方案信息，请注意保密
- 统计报告包含测试结果，请按公司规定处理

---

## 附录

### 测试类型说明

- **备选测试**：用于检验备选样品与标品是否相似，采用相似检验方法（α=0.05）
- **工厂样品**：用于检验工厂样品与标品是否存在差异，采用差异检验方法（α=0.10）

### 组别说明

三点测试通常分为 6 个组别：
- **A1、A2、A3**：第一组样品（通常为备选样品）
- **B1、B2、B3**：第二组样品（通常为标品）

每个组别包含三个选项，其中一个是正确答案（标品）。

### 参考标准

本工具按照 **GB/T 12311-2012《感官分析方法 三点检验》** 标准进行显著性判定。

---

**最后更新：** 2024年

**版本：** 1.0

